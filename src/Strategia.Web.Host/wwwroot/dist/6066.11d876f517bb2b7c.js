"use strict";(self.webpackChunkabp_zero_template=self.webpackChunkabp_zero_template||[]).push([[6066],{6066:(x,s,o)=>{o.r(s),o.d(s,{ValidateTwoFactorCodeModule:()=>w});var p=o(60263),d=o(91170),m=o(64369),u=o(58127),g=o(82805),e=o(41571),h=o(30659),f=o(15260),v=o(36895),a=o(24006),C=o(82659),S=o(97433),b=o(73565);function F(t,r){if(1&t){const n=e.\u0275\u0275getCurrentView();e.\u0275\u0275elementStart(0,"div",12)(1,"label",13)(2,"input",14),e.\u0275\u0275listener("ngModelChange",function(l){e.\u0275\u0275restoreView(n);const c=e.\u0275\u0275nextContext();return e.\u0275\u0275resetView(c.loginService.authenticateModel.rememberClient=l)}),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(3,"span",15),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"localize"),e.\u0275\u0275elementEnd()()()}if(2&t){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(2),e.\u0275\u0275property("ngModel",n.loginService.authenticateModel.rememberClient),e.\u0275\u0275advance(2),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,2,"RememberThisBrowser")," ")}}function M(t,r){if(1&t&&(e.\u0275\u0275elementStart(0,"span",16),e.\u0275\u0275text(1),e.\u0275\u0275pipe(2,"localize"),e.\u0275\u0275pipe(3,"localize"),e.\u0275\u0275elementEnd()),2&t){const n=e.\u0275\u0275nextContext();e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate2(" ",e.\u0275\u0275pipeBind1(2,2,"RemainingTime"),": ",e.\u0275\u0275pipeBind2(3,4,"SecondShort{0}",n.remainingSeconds),". ")}}const T=[{path:"",component:(()=>{class t extends u.c{constructor(n,i,l,c){super(n),this.loginService=i,this._router=l,this._recaptchaWrapperService=c,this.submitting=!1,this.remainingSeconds=90}canActivate(){return!(!this.loginService.authenticateModel||!this.loginService.authenticateResult)}ngOnInit(){if(!this.canActivate())return void this._router.navigate(["account/login"]);this.remainingSeconds=this.appSession.application.twoFactorCodeExpireSeconds;const n=(0,g.H)(1e3,1e3);this.timerSubscription=n.subscribe(()=>{this.remainingSeconds=this.remainingSeconds-1,0===this.remainingSeconds&&this.message.warn(this.l("TimeoutPleaseTryAgain")).then(()=>{this.loginService.authenticateModel.twoFactorVerificationCode=null,this._router.navigate(["account/login"])})})}ngAfterViewInit(){this._recaptchaWrapperService.setCaptchaVisibilityOnLogin()}ngOnDestroy(){this.timerSubscription&&(this.timerSubscription.unsubscribe(),this.timerSubscription=null)}submit(){let n=i=>{this.loginService.authenticateModel.twoFactorVerificationCode=this.code,this.loginService.authenticate(()=>{},null,i)};this._recaptchaWrapperService.useCaptchaOnLogin()?this._recaptchaWrapperService.getService().execute("login").subscribe(i=>n(i)):n(null)}}return t.\u0275fac=function(n){return new(n||t)(e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(h.r),e.\u0275\u0275directiveInject(d.F0),e.\u0275\u0275directiveInject(f.o))},t.\u0275cmp=e.\u0275\u0275defineComponent({type:t,selectors:[["ng-component"]],features:[e.\u0275\u0275InheritDefinitionFeature],decls:18,vars:15,consts:[[1,"login-form"],[1,"pb-13","pt-lg-0","pt-5"],["method","post",1,"login-form","form",3,"ngSubmit"],["twoFactorForm","ngForm"],[1,"mb-5"],["autoFocus","","type","password","autocomplete","new-password","name","code","required","","maxlength","16",1,"form-control","form-control-solid","h-auto","py-7","px-6","rounded-lg","fs-h6",3,"ngModel","placeholder","ngModelChange"],["passwordInput","ngModel"],[3,"formCtrl"],["class","mb-5 mt-4",4,"ngIf"],[1,"pb-lg-0","pb-5"],["type","submit",1,"btn","btn-primary","fw-bolder","fs-h6","px-8","py-4","my-3","me-3",3,"disabled"],["class","remaining-time-counter ml-5",4,"ngIf"],[1,"mb-5","mt-4"],[1,"form-check","form-check-custom","form-check-solid","py-1"],["type","checkbox","name","rememberClient","value","true",1,"form-check-input",3,"ngModel","ngModelChange"],[1,"form-check-label"],[1,"remaining-time-counter","ml-5"]],template:function(n,i){if(1&n&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"h3"),e.\u0275\u0275text(3),e.\u0275\u0275pipe(4,"localize"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(5,"form",2,3),e.\u0275\u0275listener("ngSubmit",function(){return i.submit()}),e.\u0275\u0275elementStart(7,"div",4)(8,"input",5,6),e.\u0275\u0275listener("ngModelChange",function(c){return i.code=c}),e.\u0275\u0275pipe(10,"localize"),e.\u0275\u0275elementEnd(),e.\u0275\u0275element(11,"validation-messages",7),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(12,F,6,4,"div",8),e.\u0275\u0275elementStart(13,"div",9)(14,"button",10),e.\u0275\u0275text(15),e.\u0275\u0275pipe(16,"localize"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(17,M,4,7,"span",11),e.\u0275\u0275elementEnd()()()),2&n){const l=e.\u0275\u0275reference(6),c=e.\u0275\u0275reference(9);e.\u0275\u0275property("@routerTransition",void 0),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(4,9,"VerifySecurityCode")," "),e.\u0275\u0275advance(5),e.\u0275\u0275propertyInterpolate1("placeholder","",e.\u0275\u0275pipeBind1(10,11,"Code")," *"),e.\u0275\u0275property("ngModel",i.code),e.\u0275\u0275advance(3),e.\u0275\u0275property("formCtrl",c),e.\u0275\u0275advance(1),e.\u0275\u0275property("ngIf","true"===i.s("Abp.Zero.UserManagement.TwoFactorLogin.IsRememberBrowserEnabled")),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",!l.form.valid),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(16,13,"Submit")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",i.remainingSeconds>=0)}},dependencies:[v.O5,a.\u0275NgNoValidate,a.DefaultValueAccessor,a.CheckboxControlValueAccessor,a.NgControlStatus,a.NgControlStatusGroup,a.RequiredValidator,a.MaxLengthValidator,a.NgModel,a.NgForm,C.h,S.s,b.F],styles:[".remaining-time-counter[_ngcontent-%COMP%]{color:red}"],data:{animation:[(0,m.RP)()]}}),t})(),pathMatch:"full"}];let V=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=e.\u0275\u0275defineInjector({imports:[d.Bz.forChild(T),d.Bz]}),t})();var y=o(12749);let w=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.o,y.y,V]}),t})()}}]);
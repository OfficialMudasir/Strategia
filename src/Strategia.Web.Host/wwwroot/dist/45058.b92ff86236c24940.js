"use strict";(self.webpackChunkabp_zero_template=self.webpackChunkabp_zero_template||[]).push([[45058],{45058:(T,d,i)=>{i.r(d),i.d(d,{StripePurchaseModule:()=>C});var m=i(60263),h=i(12749),p=i(91170),v=i(58127),y=i(32351),I=i(64369),o=i(37857),l=i(85079),e=i(41571),u=i(36895),f=i(17806),S=i(73565);function P(t,a){if(1&t&&e.\u0275\u0275element(0,"div",11),2&t){const n=e.\u0275\u0275nextContext();e.\u0275\u0275property("busyIf",n.stripeIsLoading)}}const g=[{path:"",component:(()=>{class t extends v.c{constructor(n,r,s,c){super(n),this._activatedRoute=r,this._stripePaymentAppService=s,this._paymentAppService=c,this.amount=0,this.description="",this.stripeIsLoading=!0,this.subscriptionPaymentGateway=o.UWJ,this.subscriptionStartType=o.gPM}ngOnInit(){this.spinnerService.show(),this.setTenantIdCookieIfNeeded(),this.stripeIsLoading=!0,this.paymentId=this._activatedRoute.snapshot.queryParams.paymentId,(new y.$).load("https://js.stripe.com/v3").then(()=>{this._stripePaymentAppService.getConfiguration().subscribe(n=>{this._stripePaymentAppService.createPaymentSession(new o.ieL({paymentId:this.paymentId,successUrl:l.g.appBaseUrl+"/account/stripe-payment-result",cancelUrl:l.g.appBaseUrl+"/account/stripe-cancel-payment"})).subscribe(r=>{this._paymentAppService.getPayment(this.paymentId).subscribe(s=>{this.spinnerService.hide(),this.amount=s.amount,this.description=s.description,this.successCallbackUrl=s.successUrl,this.errorCallbackUrl=s.errorUrl;let c=window.Stripe(n.publishableKey);document.getElementById("stripe-checkout").addEventListener("click",function(){c.redirectToCheckout({sessionId:r})}),this.stripeIsLoading=!1},s=>{this.spinnerService.hide()})},r=>{this.spinnerService.hide()})},n=>{this.spinnerService.hide()})}).catch(n=>{this.spinnerService.hide()})}setTenantIdCookieIfNeeded(){if(!this._activatedRoute.snapshot.queryParams.tenantId)return;let n=parseInt(this._activatedRoute.snapshot.queryParams.tenantId);abp.multiTenancy.setTenantIdCookie(n)}}return t.\u0275fac=function(n){return new(n||t)(e.\u0275\u0275directiveInject(e.Injector),e.\u0275\u0275directiveInject(p.gz),e.\u0275\u0275directiveInject(o.YgH),e.\u0275\u0275directiveInject(o.KC))},t.\u0275cmp=e.\u0275\u0275defineComponent({type:t,selectors:[["stripe-purchase-component"]],inputs:{editionPaymentType:"editionPaymentType"},features:[e.\u0275\u0275InheritDefinitionFeature],decls:24,vars:17,consts:[[1,"login-form"],[1,"card","card-bordered"],[1,"card-header","align-items-center"],[1,"card-body"],[1,"mb-5","row"],[1,"col-sm-4"],[1,"col-sm-8","text-end"],[1,"fw-bold"],["id","totalPrice",1,"fw-bold"],["id","stripe-checkout",1,"btn","btn-primary","w-100",3,"disabled"],[3,"busyIf",4,"ngIf"],[3,"busyIf"]],template:function(n,r){1&n&&(e.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3"),e.\u0275\u0275text(4),e.\u0275\u0275pipe(5,"localize"),e.\u0275\u0275elementEnd()(),e.\u0275\u0275elementStart(6,"div",3)(7,"div",4)(8,"label",5),e.\u0275\u0275text(9),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(10,"div",6)(11,"p",7),e.\u0275\u0275text(12),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(13,"div",4)(14,"label",5),e.\u0275\u0275text(15),e.\u0275\u0275elementEnd(),e.\u0275\u0275elementStart(16,"div",6)(17,"p",8),e.\u0275\u0275text(18),e.\u0275\u0275pipe(19,"number"),e.\u0275\u0275elementEnd()()(),e.\u0275\u0275elementStart(20,"button",9),e.\u0275\u0275text(21),e.\u0275\u0275pipe(22,"localize"),e.\u0275\u0275elementEnd(),e.\u0275\u0275template(23,P,1,1,"div",10),e.\u0275\u0275elementEnd()()()),2&n&&(e.\u0275\u0275property("@routerTransition",void 0),e.\u0275\u0275advance(4),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(5,10,"TenantSignUp")," "),e.\u0275\u0275advance(5),e.\u0275\u0275textInterpolate(r.l("Item")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate1(" ",r.description," "),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate(r.l("Price")),e.\u0275\u0275advance(3),e.\u0275\u0275textInterpolate2(" ",r.appSession.application.currencySign,"",e.\u0275\u0275pipeBind2(19,12,r.amount,"1.2-2")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("disabled",r.stripeIsLoading),e.\u0275\u0275advance(1),e.\u0275\u0275textInterpolate1(" ",e.\u0275\u0275pipeBind1(22,15,"Purchase")," "),e.\u0275\u0275advance(2),e.\u0275\u0275property("ngIf",r.stripeIsLoading))},dependencies:[u.O5,f.U,u.JJ,S.F],encapsulation:2,data:{animation:[(0,I.RP)()]}}),t})(),pathMatch:"full"}];let b=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=e.\u0275\u0275defineInjector({imports:[p.Bz.forChild(g),p.Bz]}),t})(),C=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=e.\u0275\u0275defineInjector({imports:[m.o,h.y,b]}),t})()}}]);